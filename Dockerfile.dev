# -------------------------
# Development stage
# -------------------------
FROM node:20.18.0 AS bolt-ai-development
WORKDIR /app

# Set Node.js memory options to prevent heap out of memory
ENV NODE_OPTIONS="--max-old-space-size=4096"

# Install pnpm globally
RUN npm install -g pnpm

# Install curl for health checks
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Copy package files
COPY package.json pnpm-lock.yaml ./

# Disable Husky hooks
ENV HUSKY=0

# Install all dependencies (dev + prod for development)
RUN pnpm install --frozen-lockfile

# Copy source code
COPY . .

# Set development environment
ENV NODE_ENV=development \
    PORT=5173 \
    RUNNING_IN_DOCKER=true \
    WRANGLER_SEND_METRICS=false

EXPOSE 5173

# Start development server
CMD ["pnpm", "run", "dev", "--host", "0.0.0.0"]
